/**
 * a mixin for avoiding that undefined attributes or properties values set by parent 
 * are applied to the element
 * @param  {LiElement Class} baseElement 
 * @return {LitElement Class}             
 */

const doNotSetUndefinedValue = (baseElement) => class extends baseElement {

  /**
   * Override LitElement `getPropertyDescriptor` method to avoid undefined values to be set
   */

  static getPropertyDescriptor(name, key, options) {
    return {
      // tslint:disable-next-line:no-any no symbol in index
      get() {
        return this[key];
      },
      set(value) {
        // Note(cg): prevent undefined value to be set.
        if (value === undefined) {
          return;
        }
        const oldValue = this[name];
        this[key] = value;
        this
          .requestUpdateInternal(name, oldValue, options);
      },
      configurable: true,
      enumerable: true
    };
  }
};

/**
 * Enables the default option for properties to be applied as initial property values
 *
 * @param {LitElement} baseElement - the LitElement to extend
 */
const defaultValue = (baseElement) => class extends baseElement {

  constructor() {
    super();
    if (this.constructor.properties) {
      const { properties } = this.constructor;
      const propertyNames = Object.keys(properties);
      propertyNames.forEach((propertyName) => {
        if (!this.hasOwnProperty(propertyName) && properties[propertyName].hasOwnProperty('value')) {
          this[propertyName] = properties[propertyName].value instanceof Function ? properties[propertyName].value() : properties[propertyName].value;
        }
      });
    }
  }
};

export { doNotSetUndefinedValue as a, defaultValue as d };
